<!-- 
    sender.html
    https://fiessling.ch/04_website2db/sender.html
    Diese HTML Seite zeigt ein Formular. Wird es abgeschickt, wreden die Werte als JSON string formattiert
    und per HTTP POST Request an load.php übermittelt.
    Später werden die HTTP Nachrichten nicht mehr von einer Website geschickt, sondern von einem Microcontroller
-->


<!DOCTYPE html>
<html>
<head>
    <title>Example Sender</title>
    <script>
        async function submitForm(event) {
            event.preventDefault(); // Verhindert das normale Absenden des Formulars

            // Sammle die Formulardaten und wandle sie in JSON um
            const formData = new FormData(event.target);
            const dataObject = {
                wert: formData.get("wert")
            };
            const jsonstring = JSON.stringify(dataObject);

            const messageElement = document.querySelector("#message"); // Element für die Nachricht

            try {
                // URL auf HTTP anpassen, falls kein SSL verwendet wird
                // const response = await fetch("http://localhost/04_website2db/server2db.php", {
                const response = await fetch("https://650665-4.web.fhgr.education/04_website2db/server2db.php", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json' // Setze den Content-Type auf JSON
                    },
                    body: jsonstring // Sende die Daten als JSON-String
                });

                if (response.ok) {
                    messageElement.textContent = "Message successfully delivered!";
                    messageElement.style.color = "green";
                } else {
                    // Logge den gesamten Fehler, um mehr Details zu bekommen
                    const errorMessage = await response.text();
                    messageElement.textContent = `Error: ${response.statusText} - ${errorMessage}`;
                    messageElement.style.color = "red";
                }
            } catch (error) {
                messageElement.textContent = "An error occurred: " + error.message;
                messageElement.style.color = "red";
                console.error("Fetch error:", error); // Logge den Fehler in der Konsole
            }
        }
    </script>
</head>
<body>
    <form method="POST" onsubmit="submitForm(event)">  
        <label for="wert">Wert:</label>
        <input type="text" id="wert" name="wert" required><br><br>    
        
        <input type="submit" name="submit" value="Submit">
    </form>
    <br>
    <p id="message"></p>
</body>
</html>
